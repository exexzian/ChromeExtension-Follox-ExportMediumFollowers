var followersArray=[];chrome.runtime.onMessage.addListener(function(e,i,o){function t(){return 8>=a?(d(),void o("Less than 9 followers: CSV File Download Successfully")):void 0}function r(){function e(e,i){var o=e*i.width()/100;i.find("div").animate({width:o},500).html(e+"%&nbsp;")}var i=document.querySelector("body > div.overlay > div > div > ul"),o=$("body > div.overlay > div > div > ul > li").length;$("body > div.overlay > div > div > button").click();var t=o,r=" <div id='progressBar'><div></div></div>";$("body > div.overlay > div > h3").append(r),$("#progressBar").css({background:"#000000",border:"1px solid #111","border-radius":"5px",overflow:"hidden","margin-top":"10px"}),$("#progressBar > div").css({"background-color":"#00ab6b","text-align":"right",width:"0"});var l=o,n=$("body > div.overlay > div > div > button"),s=new MutationObserver(function(i){i.forEach(function(i){"childList"===i.type&&(l=Math.ceil(100*o/a),e(l,$("#progressBar")),console.log("More Followers - expanded"),o=$("body > div.overlay > div > div > ul > li").length,console.log("currentFollowerLentgh : "+o),t=o,n.trigger("click"))})});s.observe(i,{childList:!0});var v=document.querySelector("body > div.overlay > div > div > button"),c=new MutationObserver(function(e){e.forEach(function(e){if("attributes"===e.type){console.log("attirbute mutation");var i=$("body > div.overlay > div > div > button").css("display");console.log("buttonDisplayProperty: "+i),"none"===i&&(s.disconnect(),c.disconnect(),console.log("listExapanded - complete : "+o),s.disconnect(),d(),$("#progressBar").remove())}})});c.observe(v,{attributes:!0})}function d(){$("body > div.overlay > div > div > ul > li").each(function(){var e={};rawName=$(this).find("div.list-itemDescription > a").html(),e.Name=-1===rawName.indexOf("<p")?$(this).find("div.list-itemDescription > a").text():rawName.substr(0,rawName.indexOf("<p")),e.MediumURL=$(this).find("div.list-itemDescription > a").attr("href"),e.ProfileImage=$(this).find("a > img").attr("src"),e.Description=$(this).find("div.list-itemDescription > p").text().replace(","," - "),followersArray.push(e)}),console.log("currentArray Size: "+followersArray.length);var e=s+" - MediumFollowers.csv";n({filename:e})}function l(e){var i,o,t,r,d,l;return l=e.data||null,null!=l&&l.length?(r=e.columnDelimiter||", ",d=e.lineDelimiter||"\n",t=Object.keys(l[0]),i="",i+=t.join(r),i+=d,l.forEach(function(e){o=0,t.forEach(function(t){o>0&&(i+=r),i+=e[t],o++}),i+=d}),i):null}function n(e){var i,o,t,r=l({data:followersArray});null!=r&&(o=e.filename||"export.csv",r.match(/^data:text\/csv/i)||(r="data:text/csv;charset=utf-8,"+r),i=encodeURI(r),t=document.createElement("a"),t.setAttribute("href",i),t.setAttribute("download",o),t.click())}if("report_back"===e.text){e.url;console.log("before followers click");var a=$("[id*=_obv] > div > div > div > div.u-backgroundGrayLightest.js-profileHeader > div > div > div > div.buttonSet.buttonSet--profile.u-noWrap > button:nth-child(2) > b").text().trim();if(void 0===a)return alert("Ooopppsssss... 0 Followers"),void o("Ooopppsssss... 0 Followers");var s=$("[id*=_obv] > div > div > div > div.u-backgroundGrayLightest.js-profileHeader > div > div > div > header > h1").text();$("[id*=_obv] > div > div > div > div.u-backgroundGrayLightest.js-profileHeader > div > div > div > div.buttonSet.buttonSet--profile.u-noWrap > button:nth-child(2)").trigger("click");console.log("after followers click");var v=document.querySelector("body"),c=new MutationObserver(function(e){e.forEach(function(e){"childList"===e.type&&void 0!==$("body > div.overlay > div").html()&&(console.log("followers list window loaded"),t(),c.disconnect(),r())})});c.observe(v,{childList:!0}),void 0!==$("body > div.overlay > div").html()&&(console.log("followers list window Already loaded"),c.disconnect(),t(),r()),o("CSV File Download Successfully")}});
