var followersArray=[];chrome.runtime.onMessage.addListener(function(e,i,o){function t(){return 8>=a?(l(),void o("Less than 9 followers: CSV File Download Successfully")):void 0}function r(){function e(e,i){var o=e*i.width()/100;i.find("div").animate({width:o},500).html(e+"%&nbsp;")}var i=document.querySelector("body > div.overlay > div > div > ul"),o=$("body > div.overlay > div > div > ul > li").length;$("body > div.overlay > div > div > button").click();var t=o,r=" <div id='progressBar'><div></div></div>";$("body > div.overlay > div > h3").append(r),$("#progressBar").css({background:"#000000",border:"1px solid #111","border-radius":"5px",overflow:"hidden","margin-top":"10px"}),$("#progressBar > div").css({"background-color":"#00ab6b","text-align":"right",width:"0"});var d=o,n=$("body > div.overlay > div > div > button"),s=new MutationObserver(function(i){i.forEach(function(i){"childList"===i.type&&(d=Math.ceil(100*o/a),e(d,$("#progressBar")),console.log("More Followers - expanded"),o=$("body > div.overlay > div > div > ul > li").length,console.log("currentFollowerLentgh : "+o),t=o,n.trigger("click"))})});s.observe(i,{childList:!0});var c=document.querySelector("body > div.overlay > div > div > button"),v=new MutationObserver(function(e){e.forEach(function(e){if("attributes"===e.type){console.log("attirbute mutation");var i=$("body > div.overlay > div > div > button").css("display");console.log("buttonDisplayProperty: "+i),"none"===i&&(s.disconnect(),v.disconnect(),console.log("listExapanded - complete : "+o),s.disconnect(),l(),$("#progressBar").remove())}})});v.observe(c,{attributes:!0})}function l(){$("body > div.overlay > div > div > ul > li").each(function(){var e={};rawName=$(this).find("div.list-itemDescription > a").html(),e.Name=-1===rawName.indexOf("<p")?$(this).find("div.list-itemDescription > a").text():rawName.substr(0,rawName.indexOf("<p")),e.MediumURL=$(this).find("div.list-itemDescription > a").attr("href"),e.ProfileImage=$(this).find("a > img").attr("src"),e.Description=$(this).find("div.list-itemDescription > p").text().replace(","," - "),followersArray.push(e)}),console.log("currentArray Size: "+followersArray.length);var e=s+" - MediumFollowers.csv";n({filename:e})}function d(e){var i,o,t,r,l,d;return d=e.data||null,null!=d&&d.length?(r=e.columnDelimiter||", ",l=e.lineDelimiter||"\n",t=Object.keys(d[0]),i="",i+=t.join(r),i+=l,d.forEach(function(e){o=0,t.forEach(function(t){o>0&&(i+=r),i+=e[t],o++}),i+=l}),i):null}function n(e){var i,o,t,r=d({data:followersArray});null!=r&&(o=e.filename||"export.csv",r.match(/^data:text\/csv/i)||(r="data:text/csv;charset=utf-8,"+r),i=encodeURI(r),t=document.createElement("a"),t.setAttribute("href",i),t.setAttribute("download",o),t.click())}if("report_back"===e.text){{e.url}console.log("before followers click");var a=$("[id*=_obv] > div > div.u-sizeFullHeight.u-clearfix > div > header > ul > li").attr("title").split(":")[1].trim();if(void 0===a)return alert("Ooopppsssss... 0 Followers"),void o("Ooopppsssss... 0 Followers");{var s=$("[id*=_obv] > div > div.u-sizeFullHeight.u-clearfix > div > header > h1").text();$("[id*=_obv] > div > div.u-sizeFullHeight.u-clearfix > div > header > ul > li > button").trigger("click")}console.log("after followers click");var c=document.querySelector("body"),v=new MutationObserver(function(e){e.forEach(function(e){"childList"===e.type&&void 0!==$("body > div.overlay > div").html()&&(console.log("followers list window loaded"),t(),v.disconnect(),r())})});v.observe(c,{childList:!0}),void 0!==$("body > div.overlay > div").html()&&(console.log("followers list window Already loaded"),v.disconnect(),t(),r()),o("CSV File Download Successfully")}});